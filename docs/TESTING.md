# NextBuy Security Testing Guide

This guide provides instructions for testing the NextBuy application's security features, including bot protection mechanisms and general security measures.

## Table of Contents

1. [Overview](#overview)
2. [Prerequisites](#prerequisites)
3. [Test Categories](#test-categories)
4. [Running the Test Suite](#running-the-test-suite)
5. [Interpreting Results](#interpreting-results)
6. [Manual Testing](#manual-testing)

## Overview

NextBuy includes a comprehensive security testing suite designed to evaluate:

- Bot protection mechanisms
- Rate limiting
- API security
- Authentication/authorization controls
- Input validation
- DoS attack resistance
- General security measures

These tests help ensure the application remains secure against common attack vectors.

## Prerequisites

Before running security tests:

1. **Server Setup**:
   - Ensure NextBuy server is running (`npm run dev` in the server directory)
   - Verify server is running by visiting: `http://localhost:5000/health`

2. **Testing Tools**:
   - All required testing tools are included in the `server/tests/` directory
   - Some tests require external tools (Python, Postman, etc.)

3. **Environment**:
   - Tests assume a development environment
   - Never run these tests against production servers

## Test Categories

The test suite includes 7 different categories of security tests:

### 1. cURL Tests (`curl_tests.bat`)
- Basic HTTP request testing
- Header manipulation tests
- Rate limiting validation
- Simple security checks

### 2. Postman Collection (`postman_collection.json`)
- Structured API testing
- Automated assertions
- Response validation
- Security verification

### 3. OWASP ZAP Tests (`owasp_zap_tests.py`)
- Professional penetration testing
- Vulnerability scanning
- Security report generation
- Comprehensive security assessment

### 4. Apache Benchmark Tests (`apache_benchmark_tests.bat`)
- Load testing
- Performance under stress
- Rate limiting verification
- Concurrency handling

### 5. SlowHTTPTest (`slowhttptest_tests.bat`)
- Slow-rate DoS attack simulation
- Connection exhaustion testing
- Server resilience testing
- Attack pattern simulation

### 6. Python + Requests Tests (`python_requests_tests.py`)
- Custom HTTP attack scripting
- Detailed security testing
- Pattern-based testing
- Edge case handling

### 7. Locust Tests (`locust_tests.py`)
- Scalable load testing
- User behavior simulation
- Real-time monitoring
- Statistical analysis

## Running the Test Suite

All test scripts are located in the `server/tests/` directory.

### Running Individual Tests

#### 1. cURL Tests
```bash
cd server/tests
curl_tests.bat
```

#### 2. Postman Tests
1. Open Postman
2. Import `postman_collection.json`
3. Set environment variable `baseUrl` to `http://localhost:5000`
4. Run collection

#### 3. OWASP ZAP Tests
```bash
# Ensure ZAP is running on port 8080
python owasp_zap_tests.py
```

#### 4. Apache Benchmark Tests
```bash
apache_benchmark_tests.bat
```

#### 5. SlowHTTPTest
```bash
slowhttptest_tests.bat
```

#### 6. Python + Requests Tests
```bash
python python_requests_tests.py
```

#### 7. Locust Tests
```bash
# Command line mode
python -m locust -f locust_tests.py --host=http://localhost:5000 --users 10 --spawn-rate 1 --run-time 60s

# Web UI mode
locust -f locust_tests.py --host=http://localhost:5000
# Then open http://localhost:8089
```

### Running All Tests
```bash
cd server/tests
TEST_SUITE_README.md
```

Review the TEST_SUITE_README.md file for detailed instructions on running the complete test suite.

## Interpreting Results

Test results are stored in various formats:

- **JSON Reports**: `*_results.json` files
- **HTML Reports**: Generated by some tools (ZAP, SlowHTTPTest)
- **Console Output**: Real-time results display
- **Summary Files**: Overall test results

### Success Indicators

- **HTTP 200**: Normal successful responses
- **HTTP 403**: Bot detection working (expected for suspicious requests)
- **HTTP 429**: Rate limiting active (expected for rapid requests)
- **HTTP 400**: Input validation working (expected for malicious payloads)

### Performance Baselines

- **Response Time**: < 200ms for normal requests
- **Throughput**: > 100 requests/second
- **Error Rate**: < 1% for legitimate traffic

## Manual Testing

In addition to automated tests, you can manually test security features:

### Bot Protection
1. Rapidly click UI elements to trigger behavior detection
2. Submit forms very quickly to test interaction timing
3. Use browser automation tools to test headless browser detection
4. Fill out honeypot fields to verify trapping

### Rate Limiting
1. Send multiple requests in quick succession
2. Verify rate limit headers in responses
3. Test different endpoints for appropriate limits

### Authentication
1. Test password requirements
2. Verify session handling
3. Test against common attack patterns

## Additional Resources

For more detailed testing information, refer to:
- [Bot Protection Testing](../server/docs/BOT_PROTECTION_TESTING.md)
- [TEST_SUITE_README](../server/tests/TEST_SUITE_README.md)